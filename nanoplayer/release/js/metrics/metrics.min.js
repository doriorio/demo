!function(e){function t(n){if(r[n])return r[n].exports;var a=r[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){r(1),e.exports=r(1)},function(e,t,r){var n,a;n=[r(3),r(7),r(4),r(5),r(6),r(8),r(2),r(9),r(10),r(11),r(12)],a=function(e,t,r,n,a,o,i,s,u,c,d){function f(){function f(e){return new Promise(function(t,n){function f(e){x.debug("setup error: "+e),n(Error(e))}function l(){x.debug("setup ok"),t()}try{if(x.debug("setup"),e)if("object"!=typeof e)f("Metrics config is not from type 'object'.");else if(Object.getOwnPropertyNames(e).length){for(var _ in e)if(e.hasOwnProperty(_)&&S.hasOwnProperty(_))S[_]=e[_];else{var m,M=_.split("customField");if(!(M.length>1&&0===M[0].length))return void f("The propherty '"+_+"' is not valid.");if(m=parseInt(M[1]),isNaN(m))return void f("The custom propherty '"+_+"' has no valid index number, the range is 1 to 10 e.g.'customField1'.");if(m.toString()!=M[1])return void f("The custom propherty '"+_+"' is not indexed correctly, the range is 1 to 10 e.g.'customField1'.");if(m<1||m>10)return void f("The custom propherty '"+_+"' has an index out of range, the range is 1 to 10 e.g.'customField1'.");I["application_custom_field_"+M[1]]=e[_]}var T=["player","playerConfig","statsInterval"];for(var _ in S)if(S.hasOwnProperty(_)&&T.indexOf(_)===-1&&"string"!=typeof S[_])return void f("The config propherty '"+_+"' is not from type 'string'.");var A=S.player?S.player.version.split("."):null;if(A&&A.length)if(parseInt(A[0])>=3&&parseInt(A[1])>=14)if(S.playerConfig){if(S.accountId&&S.accountKey){for(var _ in e)x.debug("metrics config["+_+"]: "+("player"!==_?JSON.stringify(e[_]):'"instanceof NanoPlayer"'));h=e.player,P=S.playerConfig,v(),b=o.create(),y=i.create(),w=s.create(S.statsInterval),O=u.create(),N=c.create(),E=d.create(),g=a.create({accountId:S.accountId,accountKey:S.accountKey}),h._metrics_tmp__onCoreEvent=h._onCoreEvent,h._onCoreEvent=function(e){"function"==typeof p&&p(e.name,e),h._metrics_tmp__onCoreEvent(e)},h._metrics_tmp_setup=h.setup,h.setup=function(e){return new Promise(function(t,n){h._metrics_tmp_setup(e).then(function(e){t(e)},function(e){"function"==typeof p&&p(r.ERROR,{name:r.ERROR,data:{code:0,message:e.message}}),n(e)})})}}else f("No credentials passed.");l()}else f("No player config passed.");else f("NanoPlayer version to old, use at least 3.14.1.");else f("No NanoPlayer passed.")}else f("Metrics config is empty.");else f("No metrics config object passed.")}catch(e){f(e.message)}})}function p(e,t){var n=l(t);switch(e){case r.READY:m(n);break;case r.LOADING:O.reset(),w.reset();break;case r.STREAM_INFO:case r.STREAM_INFO_UPDATE:T=t.data.streamInfo,_(b,"measure",t,n),m(n);break;case r.PLAY:W=t.data.stats,_(y,"measure",t,n),m(n);break;case r.STATS:A=t.data.stats,_(w,"measure",t,n)&&m(n);break;case r.START_BUFFERING:O.start();break;case r.STOP_BUFFERING:O.end(),_(O,"measure",t,n)&&(n.message=n.player_event_name="BUFFERING",m(n));break;case r.PAUSE:_(N,"measure",t,n),_(O,"reset",t,n),m(n),T={},A={},W={},C=0;break;case r.ERROR:_(E,"measure",t,n),m(n);break;case r.DESTROY:m(n);break;case r.METADATA:break;case r.PLAYBACK_FINISHED:break;case r.MEDIA:break;case r.MUTE:break;case r.UNMUTE:break;case r.VOLUME_CHANGE:break;case r.STATE_CHANGE:break;case r.WARNING:}}function l(e){var t=P.source.h5live||{},n=t.server||{websocket:"",hls:"",progressive:""},a=t.rtmp&&t.rtmp.url?t.rtmp.url:"",o=t.rtmp&&t.rtmp.streamname?t.rtmp.streamname:"",i={application_name:"h5live-player",application_user_id:S.userId,application_event_id:S.eventId,application_account_id:S.accountId,application_account_key:S.accountKey,message:e.name.replace(/\b\w/g,function(e){return e.toLowerCase()}).replace(/([A-Z])/g,"_$1").toUpperCase(),severity:"info",client_ip:"",origin:document.location.origin,path_name:document.location.pathname,referrer:document.location.href,search:document.location.search,os:M.os,os_version:M.osVersion,browser:M.browser,browser_version:M.browserVersion,player_id:h.id,player_type:h.type,player_version:h.version,player_event_name:e.name.replace(/\b\w/g,function(e){return e.toLowerCase()}).replace(/([A-Z])/g,"_$1").toUpperCase(),server_domain:n.websocket.length?n.websocket.split("//")[1].split("/")[0]:"",rtmp_url:a,rtmp_streamname:o,connection_id:T&&T.url?T.url.split("&cid=")[1].split("&pid=")[0]:"",time_played:A.currentTime?Math.round(1e3*A.currentTime)/1e3:0,time_elapsed:e.name===r.PLAY&&(C=performance.now())||0===A.currentTime?0:Math.round(performance.now()-C)/1e3,bintu_orga_hash:a.indexOf("bintu")!==-1||n.websocket.length&&n.websocket.indexOf("bintu")!==-1&&a.indexOf("localhost")!==-1?o.split("-")[0]:""};for(var s in I)I.hasOwnProperty(s)&&(i[s]=I[s]);return i}function _(e,t,r,n){var a=e[t](r,n);if(a){for(var o in a)a.hasOwnProperty(o)&&(n[o]=a[o]);return!0}return!1}function m(e){x.debug("send "+e.player_event_name),g.send(e.player_event_name,e)}function v(){g&&(g.destroy(),g=null),b=null,y=null,w=null,O=null,N=null,E=null,h&&("function"==typeof h._metrics_tmp__onCoreEvent&&(x.debug("wrapped player function detected, restore '_onCoreEvent', delete '_metrics_tmp__onCoreEvent'"),h._onCoreEvent=h._metrics_tmp__onCoreEvent,delete h._metrics_tmp__onCoreEvent),"function"==typeof h._metrics_tmp_setup&&(x.debug("wrapped player function detected, restore 'setup', delete '_metrics_tmp_setup'"),h.setup=h._metrics_tmp_setup,delete h._metrics_tmp_setup))}console.log("NanoPlayerMetricsCollector "+e.METRICS);var g,h,b,y,w,O,N,E,S={accountId:void 0,accountKey:void 0,player:void 0,playerConfig:void 0,userId:"",eventId:"",statsInterval:10},I={},x=t.create("MetricsCollector"),M=n,T={},A={},W={},P={},C=0;return{setup:f,destroy:v}}return window.NanoPlayerMetricsCollector=f,window.NanoPlayerMetricsCollector}.apply(t,n),!(void 0!==a&&(e.exports=a))},function(e,t,r){var n,a;n=[],a=function(){function e(){function e(e,t){var r=e.data.stats,n={},a=[{start:"connecting",end:"connecting",measurement:"play_connecting",value:0},{start:"connecting",end:"connected",measurement:"play_connected",value:0},{start:"connected",end:"firstFragmentReceived",measurement:"play_first_fragment_received",value:0},{start:"firstFragmentReceived",end:"firstFrameRendered",measurement:"play_first_frame_rendered",value:0},{start:"firstFrameRendered",end:"playable",measurement:"play_playable",value:0},{start:"playable",end:"playing",measurement:"play_playing",value:0}];return a.forEach(function(e,t){var a=r[e.start],o=r[e.end];o-a>=0&&(e.value=Math.floor(o-a)),n[e.measurement+"_relative"]=e.value,n[e.measurement+"_absolute"]=r[e.end]}),n.play_start_time_total=n.play_playing_absolute,n}return{measure:e}}return{create:e}}.apply(t,n),!(void 0!==a&&(e.exports=a))},function(e,t,r){var n,a;n=[],a=function(){return Object.freeze({METRICS:"1.0.0"})}.apply(t,n),!(void 0!==a&&(e.exports=a))},function(e,t,r){var n,a;n=[],a=function(){return Object.freeze({READY:"Ready",ERROR:"Error",PAUSE:"Pause",LOADING:"Loading",START_BUFFERING:"StartBuffering",STOP_BUFFERING:"StopBuffering",PLAY:"Play",METADATA:"MetaData",STATS:"Stats",PLAYBACK_FINISHED:"PlaybackFinished",MEDIA:"Media",STREAM_INFO:"StreamInfo",STREAM_INFO_UPDATE:"StreamInfoUpdate",MUTE:"Mute",UNMUTE:"Unmute",VOLUME_CHANGE:"VolumeChange",STATE_CHANGE:"StateChange",WARNING:"Warning",DESTROY:"Destroy"})}.apply(t,n),!(void 0!==a&&(e.exports=a))},function(e,t,r){var n,a;n=[],a=function(){"use strict";var e="Unknown",t="";if(screen.width){var r=screen.width?screen.width:"",n=screen.height?screen.height:"";t+=""+r+" x "+n}var a,o,i,s=navigator.appVersion,u=navigator.userAgent,c=navigator.appName,d=""+parseFloat(navigator.appVersion),f=parseInt(navigator.appVersion,10);(o=u.indexOf("Opera"))!=-1&&(c="Opera",d=u.substring(o+6),(o=u.indexOf("Version"))!=-1&&(d=u.substring(o+8))),(o=u.indexOf("OPR/"))!=-1?(c="Opera",d=u.substring(o+4)):(o=u.indexOf("MSIE"))!=-1?(c="Microsoft Internet Explorer",d=u.substring(o+5)):"Netscape"==c&&(o=u.indexOf("Trident/"))!=-1?(c="Microsoft Internet Explorer",d=u.substring(o+8),(o=u.indexOf("rv:"))!=-1&&(d=u.substring(o+3))):"Netscape"==c&&(o=u.indexOf("Edge/"))!=-1?(c="Microsoft Edge",d=u.substring(o+5)):(o=u.indexOf("Chrome"))!=-1?(c="Chrome",d=u.substring(o+7)):(o=u.indexOf("Safari"))!=-1?(c="Safari",d=u.substring(o+7),(o=u.indexOf("Version"))!=-1&&(d=u.substring(o+8)),u.indexOf("CriOS")!=-1&&(c="Chrome")):(o=u.indexOf("Firefox"))!=-1?(c="Firefox",d=u.substring(o+8)):(a=u.lastIndexOf(" ")+1)<(o=u.lastIndexOf("/"))&&(c=u.substring(a,o),d=u.substring(o+1),c.toLowerCase()==c.toUpperCase()&&(c=navigator.appName)),(i=d.indexOf(";"))!=-1&&(d=d.substring(0,i)),(i=d.indexOf(" "))!=-1&&(d=d.substring(0,i)),(i=d.indexOf(")"))!=-1&&(d=d.substring(0,i)),f=parseInt(""+d,10),isNaN(f)&&(d=""+parseFloat(navigator.appVersion),f=parseInt(navigator.appVersion,10));var p=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(s),l=!!navigator.cookieEnabled;"undefined"!=typeof navigator.cookieEnabled||l||(document.cookie="testcookie",l=document.cookie.indexOf("testcookie")!==-1);var _=e,m=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 10",r:/(Windows 10|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var v in m){var g=m[v];if(g.r.test(u)){_=g.s;break}}var h=e;switch(/Windows/.test(_)&&(h=/Windows (.*)/.exec(_)[1],_="Windows"),_){case"Mac OS X":h=/Mac OS X (10[\.\_\d]+)/.exec(u)[1];break;case"Android":h=/Android ([\.\_\d]+)/.exec(u)[1];break;case"iOS":h=/OS (\d+)_(\d+)_?(\d+)?/.exec(s),h=h[1]+"."+h[2]+"."+(0|h[3])}var b={screen:t,browser:c,browserVersion:d,mobile:p,os:_,osVersion:h,cookies:l};return b}.apply(t,n),!(void 0!==a&&(e.exports=a))},function(e,t,r){var n,a;n=[r(7)],a=function(e){function t(t){function r(e,t){try{s+=1;var r=new XMLHttpRequest;u[s]=r;var a=u[s];if(a.open("POST",o,!0),a.onreadystatechange=function(e,t){if(this&&4===this.readyState){var r=this.status>=400?"fail":this.status>=200?"success":"unknown";n.call(null,e,t,r)}}.bind(a,s,e),["abort","error","timeout"].forEach(function(t){a.addEventListener(t,n.bind(null,s,e,t))}),"undefined"!=typeof t){if("string"==typeof t)try{t=JSON.parse(t)}catch(e){t=null}if("object"==typeof t)try{t=JSON.stringify(t),d.debug("#"+s+" "+e+" send "+t),setTimeout(n.bind(null,s,e,"suspend"),5e3),a.send(t)}catch(e){n.call(null,s,"catch "+e.message)}}else a.send()}catch(e){n.call(null,s,"catch "+e.message)}}function n(e,t,r){"undefined"!=typeof u[e]&&(d.debug("#"+e+" "+t+" "+r+" "+u[e].status),delete u[e])}function a(){for(var e in u)u.hasOwnProperty(e)&&delete u[e]}var o,i={accountId:void 0,accountKey:void 0},s=0,u={},c="https://glog1.nanocosmos.de/gelf/",d=e.create("MetricsLogger");for(var f in i)i.hasOwnProperty(f)&&t&&t.hasOwnProperty(f)&&void 0!==t[f]&&(i[f]=t[f]);return o=c+i.accountKey,{send:r,destroy:a}}return{create:t}}.apply(t,n),!(void 0!==a&&(e.exports=a))},function(e,t,r){var n,a;n=[],a=function(){function e(e){return{debug:t.bind(this,f,e),info:t.bind(this,d,e),warn:t.bind(this,c,e),error:t.bind(this,u,e),detail:t.bind(this,p,e),getHTTPParam:a}}function t(e,t,r){try{i>=e&&console.debug(o()+": ["+t+"] "+r)}catch(e){}}function r(){var e=isNaN(a("debug"))?0:+a("debug"),t=+n("nanoDebug");return Math.max(e,t)}function n(e){return document.cookie.indexOf(e+"=")!==-1?document.cookie.split(e+"=")[1].split(";")[0]:null}function a(e){if(!s){s=[];var t=document.location.search.substr(1,document.location.search.length);if(""===t&&document.location.href.indexOf("?")!==-1){var r=document.location.href.indexOf("?")+1;t=document.location.href.slice(r)}if(""!==t)for(var n=t.split("&"),a=0;a<n.length;++a){var o="",i=n[a].split("="),u=i[0];i.length>1&&(o=i[1]),s[decodeURIComponent(u)]=decodeURIComponent(o)}}try{return s[e]}catch(e){return}}function o(){return(new Date).toISOString()}var i=r(),s=void 0;setInterval(function(){i=r()},5e3);var u=0,c=1,d=2,f=3,p=4;return{create:e}}.apply(t,n),!(void 0!==a&&(e.exports=a))},function(e,t,r){var n,a;n=[],a=function(){function e(){function e(e,t){var r=e.data.streamInfo;return{stream_info_has_audio:r.haveAudio,stream_info_has_video:r.haveVideo,stream_info_width:r.videoInfo?r.videoInfo.width:0,stream_info_height:r.videoInfo?r.videoInfo.height:0,stream_info_frame_rate:r.videoInfo?r.videoInfo.frameRate:0,stream_info_sample_rate:r.audioInfo?r.audioInfo.sampleRate:0,stream_info_channels:r.audioInfo?r.audioInfo.channels:0,stream_info_bits_per_sample:r.audioInfo?r.audioInfo.bitsPerSample:0,connection_id:r.url.split("&cid=")[1].split("&pid=")[0]}}return{measure:e}}return{create:e}}.apply(t,n),!(void 0!==a&&(e.exports=a))},function(e,t,r){var n,a;n=[],a=function(){function e(e){function t(e,t){var r=e.data.stats;for(i+=1,s.push(r.buffer.delay.current),u.push(r.bitrate.current),c.push(r.framerate.current);s.length>o;)s.shift();for(;u.length>o;)u.shift();for(;c.length>o;)c.shift();if(i%o===0){var n=JSON.parse(JSON.stringify(s)).sort(function(e,t){return e-t},0),a=JSON.parse(JSON.stringify(u)).sort(function(e,t){return e-t},0),f=JSON.parse(JSON.stringify(c)).sort(function(e,t){return e-t},0);return d.stats_buffer_average=Math.round(n.reduce(function(e,t){return e+t},0)/n.length*1e3)/1e3,d.stats_buffer_min=Math.round(1e3*n[0])/1e3,d.stats_buffer_max=Math.round(1e3*n[n.length-1])/1e3,d.stats_bitrate_average=Math.round(a.reduce(function(e,t){return e+t},0)/a.length/1e3),d.stats_bitrate_min=Math.round(a[0]/1e3),d.stats_bitrate_max=Math.round(a[n.length-1]/1e3),d.stats_frame_rate_average=Math.round(f.reduce(function(e,t){return e+t},0)/f.length*1e3)/1e3,d.stats_frame_rate_min=f[0],d.stats_frame_rate_max=f[f.length-1],d.stats_measure_count+=1,d}return!1}function r(){for(i=0;s.length;)s.shift();for(;u.length;)u.shift();for(;c.length;)c.shift();for(var e in d)"stats_measure_samples"!==e&&(d[e]=0)}var n=10;e&&!isNaN(e)&&e>=1&&(n=e);var a=10,o=a*n,i=0,s=[],u=[],c=[],d={stats_buffer_average:0,stats_buffer_min:0,stats_buffer_max:0,stats_bitrate_average:0,stats_bitrate_min:0,stats_bitrate_max:0,stats_frame_rate_average:0,stats_frame_rate_min:0,stats_frame_rate_max:0,stats_measure_count:0,stats_measure_samples:o};return{measure:t,reset:r}}return{create:e}}.apply(t,n),!(void 0!==a&&(e.exports=a))},function(e,t,r){var n,a;n=[],a=function(){function e(){function e(){o=performance.now()}function t(){i=performance.now()}function r(e,t){if(i){var r=Math.round(Math.abs(i-o))/1e3;if(i=o=0,r>=a){s.push(r),u.buffering_duration_current=r,u.buffering_duration_total+=r,u.buffering_count+=1,u.buffering_duration_average=Math.round(u.buffering_duration_total/u.buffering_count*1e3)/1e3;for(var n in u)!/buffering_count/.test(n)&&u[n];return u}}return!1}function n(e,t){if(e&&t){for(i=o=0;s.length;)s.pop();var r={};for(var n in u)!/buffering_duration_current/.test(n)&&(r[n]=u[n]),u[n]=0;return r.time_played_total=t.time_played,r.time_elapsed_total=t.time_elapsed,r.time_buffering_total=r.buffering_duration_total,r}}var a=1,o=0,i=0,s=[],u={buffering_duration_current:0,buffering_duration_average:0,buffering_duration_total:0,buffering_count:0};return{start:e,end:t,measure:r,reset:n}}return{create:e}}.apply(t,n),!(void 0!==a&&(e.exports=a))},function(e,t,r){var n,a;n=[],a=function(){function e(){function e(e,t){return{pause_reason:e.data.reason}}return{measure:e}}return{create:e}}.apply(t,n),!(void 0!==a&&(e.exports=a))},function(e,t,r){var n,a;n=[],a=function(){function e(){function e(e,t){return{error_code:e.data.code,error_message:e.data.message}}return{measure:e}}return{create:e}}.apply(t,n),!(void 0!==a&&(e.exports=a))}]);