!function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={exports:{},id:r,loaded:!1};return e[r].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){n(1),e.exports=n(1)},function(e,t,n){var r,a;r=[n(3),n(7),n(4),n(5),n(6),n(8),n(2),n(9),n(10),n(11),n(12)],a=function(e,t,n,r,a,o,i,s,u,c,d){function f(){function f(e){return new Promise(function(t,r){function f(e){x.debug("setup error: "+e),r(Error(e))}function p(){x.debug("setup ok"),t()}try{if(x.debug("setup"),e)if("object"!=typeof e)f("Metrics config is not from type 'object'.");else if(Object.getOwnPropertyNames(e).length){for(var _ in e)if(e.hasOwnProperty(_)&&I.hasOwnProperty(_))I[_]=e[_];else{var m,v=_.split("customField");if(!(v.length>1&&0===v[0].length))return void f("The propherty '"+_+"' is not valid.");if(m=parseInt(v[1]),isNaN(m))return void f("The custom propherty '"+_+"' has no valid index number, the range is 1 to 10 e.g.'customField1'.");if(m.toString()!=v[1])return void f("The custom propherty '"+_+"' is not indexed correctly, the range is 1 to 10 e.g.'customField1'.");if(m<1||m>10)return void f("The custom propherty '"+_+"' has an index out of range, the range is 1 to 10 e.g.'customField1'.");E["application_custom_field_"+v[1]]=e[_]}var M=["player","playerConfig","statsInterval"];for(var _ in I)if(I.hasOwnProperty(_)&&M.indexOf(_)===-1&&"string"!=typeof I[_])return void f("The config propherty '"+_+"' is not from type 'string'.");var T=I.player?I.player.version.split("."):null;T&&T.length?parseInt(T[0])>=3&&parseInt(T[1])>=14?I.playerConfig?I.accountId&&I.accountKey?(x.debug("metrics config: "+JSON.stringify(I)),b=o.create(),y=i.create(),w=s.create(I.statsInterval),O=u.create(),N=c.create(),S=d.create(),g=a.create({accountId:I.accountId,accountKey:I.accountKey}),h=e.player,h.__onCoreEvent=h._onCoreEvent,h._onCoreEvent=function(e){l(e.name,e),h.__onCoreEvent(e)},h.__setup=h.setup,h.setup=function(e){return new Promise(function(t,r){h.__setup(e).then(function(e){t(e)},function(e){l(n.ERROR,{name:n.ERROR,data:{code:0,message:e.message}}),r(e)})})},P=I.playerConfig,p()):f("No credentials passed."):f("No player config passed."):f("NanoPlayer version to old, use at least 3.14.1."):f("No NanoPlayer passed.")}else f("Metrics config is empty.");else f("No metrics config object passed.")}catch(e){f(e.message)}})}function l(e,t){var r=p(t);switch(e){case n.READY:m(r);break;case n.LOADING:O.reset(),w.reset();break;case n.STREAM_INFO:case n.STREAM_INFO_UPDATE:T=t.data.streamInfo,_(b,"measure",t,r),m(r);break;case n.PLAY:W=t.data.stats,_(y,"measure",t,r),m(r);break;case n.STATS:A=t.data.stats,_(w,"measure",t,r)&&m(r);break;case n.START_BUFFERING:O.start();break;case n.STOP_BUFFERING:O.end(),_(O,"measure",t,r)&&(r.message=r.player_event_name="BUFFERING",m(r));break;case n.PAUSE:_(N,"measure",t,r),_(O,"reset",t,r),m(r),T={},A={},W={},R=0;break;case n.ERROR:_(S,"measure",t,r),m(r);break;case n.DESTROY:m(r);break;case n.METADATA:break;case n.PLAYBACK_FINISHED:break;case n.MEDIA:break;case n.MUTE:break;case n.UNMUTE:break;case n.VOLUME_CHANGE:break;case n.STATE_CHANGE:break;case n.WARNING:}}function p(e){var t=P.source.h5live||{},r=t.server||{websocket:"",hls:"",progressive:""},a=t.rtmp&&t.rtmp.url?t.rtmp.url:"",o=t.rtmp&&t.rtmp.streamname?t.rtmp.streamname:"",i={application_name:"h5live-player",application_user_id:I.userId,application_event_id:I.eventId,application_account_id:I.accountId,application_account_key:I.accountKey,message:e.name.replace(/\b\w/g,function(e){return e.toLowerCase()}).replace(/([A-Z])/g,"_$1").toUpperCase(),severity:"info",client_ip:"",origin:document.location.origin,path_name:document.location.pathname,referrer:document.location.href,search:document.location.search,os:M.os,os_version:M.osVersion,browser:M.browser,browser_version:M.browserVersion,player_id:h.id,player_type:h.type,player_version:h.version,player_event_name:e.name.replace(/\b\w/g,function(e){return e.toLowerCase()}).replace(/([A-Z])/g,"_$1").toUpperCase(),server_domain:r.websocket.length?r.websocket.split("//")[1].split("/")[0]:"",rtmp_url:a,rtmp_streamname:o,connection_id:T&&T.url?T.url.split("&cid=")[1].split("&pid=")[0]:"",time_played:A.currentTime?Math.round(1e3*A.currentTime)/1e3:0,time_elapsed:e.name===n.PLAY&&(R=performance.now())||0===A.currentTime?0:Math.round(performance.now()-R)/1e3,bintu_orga_hash:a.indexOf("bintu")!==-1||r.websocket.length&&r.websocket.indexOf("bintu")!==-1&&a.indexOf("localhost")!==-1?o.split("-")[0]:""};for(var s in E)E.hasOwnProperty(s)&&(i[s]=E[s]);return i}function _(e,t,n,r){var a=e[t](n,r);if(a){for(var o in a)a.hasOwnProperty(o)&&(r[o]=a[o]);return!0}return!1}function m(e){x.debug("send "+e.player_event_name),g.send(e.player_event_name,e)}function v(){g&&(g.destroy(),g=null),b=null,y=null,w=null,O=null,N=null,S=null,h&&(h._onCoreEvent=h.__onCoreEvent,delete h.__onCoreEvent)}console.log("NanoPlayerMetricsCollector "+e.METRICS);var g,h,b,y,w,O,N,S,I={accountId:void 0,accountKey:void 0,player:void 0,playerConfig:void 0,userId:"",eventId:"",statsInterval:10},E={},x=t.create("MetricsCollector"),M=r,T={},A={},W={},P={},R=0;return{setup:f,destroy:v}}return window.NanoPlayerMetricsCollector=f,window.NanoPlayerMetricsCollector}.apply(t,r),!(void 0!==a&&(e.exports=a))},function(e,t,n){var r,a;r=[],a=function(){function e(){function e(e,t){var n=e.data.stats,r={},a=[{start:"connecting",end:"connecting",measurement:"play_connecting",value:0},{start:"connecting",end:"connected",measurement:"play_connected",value:0},{start:"connected",end:"firstFragmentReceived",measurement:"play_first_fragment_received",value:0},{start:"firstFragmentReceived",end:"firstFrameRendered",measurement:"play_first_frame_rendered",value:0},{start:"firstFrameRendered",end:"playable",measurement:"play_playable",value:0},{start:"playable",end:"playing",measurement:"play_playing",value:0}];return a.forEach(function(e,t){var a=n[e.start],o=n[e.end];o-a>=0&&(e.value=Math.floor(o-a)),r[e.measurement+"_relative"]=e.value,r[e.measurement+"_absolute"]=n[e.end]}),r.play_start_time_total=r.play_playing_absolute,r}return{measure:e}}return{create:e}}.apply(t,r),!(void 0!==a&&(e.exports=a))},function(e,t,n){var r,a;r=[],a=function(){return Object.freeze({METRICS:"1.0.0"})}.apply(t,r),!(void 0!==a&&(e.exports=a))},function(e,t,n){var r,a;r=[],a=function(){return Object.freeze({READY:"Ready",ERROR:"Error",PAUSE:"Pause",LOADING:"Loading",START_BUFFERING:"StartBuffering",STOP_BUFFERING:"StopBuffering",PLAY:"Play",METADATA:"MetaData",STATS:"Stats",PLAYBACK_FINISHED:"PlaybackFinished",MEDIA:"Media",STREAM_INFO:"StreamInfo",STREAM_INFO_UPDATE:"StreamInfoUpdate",MUTE:"Mute",UNMUTE:"Unmute",VOLUME_CHANGE:"VolumeChange",STATE_CHANGE:"StateChange",WARNING:"Warning",DESTROY:"Destroy"})}.apply(t,r),!(void 0!==a&&(e.exports=a))},function(e,t,n){var r,a;r=[],a=function(){"use strict";var e="Unknown",t="";if(screen.width){var n=screen.width?screen.width:"",r=screen.height?screen.height:"";t+=""+n+" x "+r}var a,o,i,s=navigator.appVersion,u=navigator.userAgent,c=navigator.appName,d=""+parseFloat(navigator.appVersion),f=parseInt(navigator.appVersion,10);(o=u.indexOf("Opera"))!=-1&&(c="Opera",d=u.substring(o+6),(o=u.indexOf("Version"))!=-1&&(d=u.substring(o+8))),(o=u.indexOf("OPR/"))!=-1?(c="Opera",d=u.substring(o+4)):(o=u.indexOf("MSIE"))!=-1?(c="Microsoft Internet Explorer",d=u.substring(o+5)):"Netscape"==c&&(o=u.indexOf("Trident/"))!=-1?(c="Microsoft Internet Explorer",d=u.substring(o+8),(o=u.indexOf("rv:"))!=-1&&(d=u.substring(o+3))):"Netscape"==c&&(o=u.indexOf("Edge/"))!=-1?(c="Microsoft Edge",d=u.substring(o+5)):(o=u.indexOf("Chrome"))!=-1?(c="Chrome",d=u.substring(o+7)):(o=u.indexOf("Safari"))!=-1?(c="Safari",d=u.substring(o+7),(o=u.indexOf("Version"))!=-1&&(d=u.substring(o+8)),u.indexOf("CriOS")!=-1&&(c="Chrome")):(o=u.indexOf("Firefox"))!=-1?(c="Firefox",d=u.substring(o+8)):(a=u.lastIndexOf(" ")+1)<(o=u.lastIndexOf("/"))&&(c=u.substring(a,o),d=u.substring(o+1),c.toLowerCase()==c.toUpperCase()&&(c=navigator.appName)),(i=d.indexOf(";"))!=-1&&(d=d.substring(0,i)),(i=d.indexOf(" "))!=-1&&(d=d.substring(0,i)),(i=d.indexOf(")"))!=-1&&(d=d.substring(0,i)),f=parseInt(""+d,10),isNaN(f)&&(d=""+parseFloat(navigator.appVersion),f=parseInt(navigator.appVersion,10));var l=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(s),p=!!navigator.cookieEnabled;"undefined"!=typeof navigator.cookieEnabled||p||(document.cookie="testcookie",p=document.cookie.indexOf("testcookie")!==-1);var _=e,m=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 10",r:/(Windows 10|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var v in m){var g=m[v];if(g.r.test(u)){_=g.s;break}}var h=e;switch(/Windows/.test(_)&&(h=/Windows (.*)/.exec(_)[1],_="Windows"),_){case"Mac OS X":h=/Mac OS X (10[\.\_\d]+)/.exec(u)[1];break;case"Android":h=/Android ([\.\_\d]+)/.exec(u)[1];break;case"iOS":h=/OS (\d+)_(\d+)_?(\d+)?/.exec(s),h=h[1]+"."+h[2]+"."+(0|h[3])}var b={screen:t,browser:c,browserVersion:d,mobile:l,os:_,osVersion:h,cookies:p};return b}.apply(t,r),!(void 0!==a&&(e.exports=a))},function(e,t,n){var r,a;r=[n(7)],a=function(e){function t(e){function t(e,t){try{a+=1;var r=new XMLHttpRequest;o[a]=r;var i=o[a];if(i.open("POST",n,!0),i.onreadystatechange=function(e,t){if(this&&4===this.readyState){var n=this.status>=400?"fail":this.status>=200?"success":"unknown";u.call(null,e,t,n)}}.bind(i,a,e),["abort","error","timeout"].forEach(function(t){i.addEventListener(t,u.bind(null,a,e,t))}),"undefined"!=typeof t){if("string"==typeof t)try{t=JSON.parse(t)}catch(e){t=null}if("object"==typeof t)try{t=JSON.stringify(t),s.debug("#"+a+" "+e+" send "+t),setTimeout(u.bind(null,a,e,"suspend"),5e3),i.send(t)}catch(e){u.call(null,a,"catch "+e.message)}}else i.send()}catch(e){u.call(null,a,"catch "+e.message)}}function u(e,t,n){"undefined"!=typeof o[e]&&(s.debug("#"+e+" "+t+" "+n+" "+o[e].status),delete o[e])}function c(){for(var e in o)o.hasOwnProperty(e)&&delete o[e]}for(var d in r)r.hasOwnProperty(d)&&e&&e.hasOwnProperty(d)&&void 0!==e[d]&&(r[d]=e[d]);return n=i+r.accountKey,{send:t,destroy:c}}var n,r={accountId:void 0,accountKey:void 0},a=0,o={},i="https://glog1.nanocosmos.de/gelf/",s=e.create("MetricsLogger");return{create:t}}.apply(t,r),!(void 0!==a&&(e.exports=a))},function(e,t,n){var r,a;r=[],a=function(){function e(e){return{debug:t.bind(this,f,e),info:t.bind(this,d,e),warn:t.bind(this,c,e),error:t.bind(this,u,e),detail:t.bind(this,l,e),getHTTPParam:a}}function t(e,t,n){try{i>=e&&console.debug(o()+": ["+t+"] "+n)}catch(e){}}function n(){var e=isNaN(a("debug"))?0:+a("debug"),t=+r("nanoDebug");return Math.max(e,t)}function r(e){return document.cookie.indexOf(e+"=")!==-1?document.cookie.split(e+"=")[1].split(";")[0]:null}function a(e){if(!s){s=[];var t=document.location.search.substr(1,document.location.search.length);if(""===t&&document.location.href.indexOf("?")!==-1){var n=document.location.href.indexOf("?")+1;t=document.location.href.slice(n)}if(""!==t)for(var r=t.split("&"),a=0;a<r.length;++a){var o="",i=r[a].split("="),u=i[0];i.length>1&&(o=i[1]),s[decodeURIComponent(u)]=decodeURIComponent(o)}}try{return s[e]}catch(e){return}}function o(){return(new Date).toISOString()}var i=n(),s=void 0;setInterval(function(){i=n()},5e3);var u=0,c=1,d=2,f=3,l=4;return{create:e}}.apply(t,r),!(void 0!==a&&(e.exports=a))},function(e,t,n){var r,a;r=[],a=function(){function e(){function e(e,t){var n=e.data.streamInfo;return{stream_info_has_audio:n.haveAudio,stream_info_has_video:n.haveVideo,stream_info_width:n.videoInfo?n.videoInfo.width:0,stream_info_height:n.videoInfo?n.videoInfo.height:0,stream_info_frame_rate:n.videoInfo?n.videoInfo.frameRate:0,stream_info_sample_rate:n.audioInfo?n.audioInfo.sampleRate:0,stream_info_channels:n.audioInfo?n.audioInfo.channels:0,stream_info_bits_per_sample:n.audioInfo?n.audioInfo.bitsPerSample:0,connection_id:n.url.split("&cid=")[1].split("&pid=")[0]}}return{measure:e}}return{create:e}}.apply(t,r),!(void 0!==a&&(e.exports=a))},function(e,t,n){var r,a;r=[],a=function(){function e(e){function t(e,t){var n=e.data.stats;for(i+=1,s.push(n.buffer.delay.current),u.push(n.bitrate.current),c.push(n.framerate.current);s.length>o;)s.shift();for(;u.length>o;)u.shift();for(;c.length>o;)c.shift();if(i%o===0){var r=JSON.parse(JSON.stringify(s)).sort(function(e,t){return e-t},0),a=JSON.parse(JSON.stringify(u)).sort(function(e,t){return e-t},0),f=JSON.parse(JSON.stringify(c)).sort(function(e,t){return e-t},0);return d.stats_buffer_average=Math.round(r.reduce(function(e,t){return e+t},0)/r.length*1e3)/1e3,d.stats_buffer_min=Math.round(1e3*r[0])/1e3,d.stats_buffer_max=Math.round(1e3*r[r.length-1])/1e3,d.stats_bitrate_average=Math.round(a.reduce(function(e,t){return e+t},0)/a.length/1e3),d.stats_bitrate_min=Math.round(a[0]/1e3),d.stats_bitrate_max=Math.round(a[r.length-1]/1e3),d.stats_frame_rate_average=Math.round(f.reduce(function(e,t){return e+t},0)/f.length*1e3)/1e3,d.stats_frame_rate_min=f[0],d.stats_frame_rate_max=f[f.length-1],d.stats_measure_count+=1,d}return!1}function n(){for(i=0;s.length;)s.shift();for(;u.length;)u.shift();for(;c.length;)c.shift();for(var e in d)"stats_measure_samples"!==e&&(d[e]=0)}var r=10;e&&!isNaN(e)&&e>=1&&(r=e);var a=10,o=a*r,i=0,s=[],u=[],c=[],d={stats_buffer_average:0,stats_buffer_min:0,stats_buffer_max:0,stats_bitrate_average:0,stats_bitrate_min:0,stats_bitrate_max:0,stats_frame_rate_average:0,stats_frame_rate_min:0,stats_frame_rate_max:0,stats_measure_count:0,stats_measure_samples:o};return{measure:t,reset:n}}return{create:e}}.apply(t,r),!(void 0!==a&&(e.exports=a))},function(e,t,n){var r,a;r=[],a=function(){function e(){function e(){o=performance.now()}function t(){i=performance.now()}function n(e,t){if(i){var n=Math.round(Math.abs(i-o))/1e3;if(i=o=0,n>=a){s.push(n),u.buffering_duration_current=n,u.buffering_duration_total+=n,u.buffering_count+=1,u.buffering_duration_average=Math.round(u.buffering_duration_total/u.buffering_count*1e3)/1e3;for(var r in u)!/buffering_count/.test(r)&&u[r];return u}}return!1}function r(e,t){if(e&&t){for(i=o=0;s.length;)s.pop();var n={};for(var r in u)!/buffering_duration_current/.test(r)&&(n[r]=u[r]),u[r]=0;return n.time_played_total=t.time_played,n.time_elapsed_total=t.time_elapsed,n.time_buffering_total=n.buffering_duration_total,n}}var a=1,o=0,i=0,s=[],u={buffering_duration_current:0,buffering_duration_average:0,buffering_duration_total:0,buffering_count:0};return{start:e,end:t,measure:n,reset:r}}return{create:e}}.apply(t,r),!(void 0!==a&&(e.exports=a))},function(e,t,n){var r,a;r=[],a=function(){function e(){function e(e,t){return{pause_reason:e.data.reason}}return{measure:e}}return{create:e}}.apply(t,r),!(void 0!==a&&(e.exports=a))},function(e,t,n){var r,a;r=[],a=function(){function e(){function e(e,t){return{error_code:e.data.code,error_message:e.data.message}}return{measure:e}}return{create:e}}.apply(t,r),!(void 0!==a&&(e.exports=a))}]);
//# sourceMappingURL=metrics.min.js.map